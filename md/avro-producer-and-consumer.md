# Avro Producer and Consumer

These examples produce and consume messages from the `supplier` topic. The producer example produces random suppliers.

The goal is to communicate producers and consumers with avro serialized messages.

### Other Links

- [confluent avro producer and consumer examples](https://docs.confluent.io/platform/current/schema-registry/serdes-develop/serdes-avro.html)
- [kafka consumer settings](https://docs.confluent.io/platform/current/installation/configuration/consumer-configs.html)
- [kafka producer settings](https://docs.confluent.io/platform/current/installation/configuration/producer-configs.html)

## Avro Schema

<iframe width="560" height="315" src="https://www.youtube.com/embed/SZX9DM_gyOE"></iframe>

Avro allows us to serialize/deserialize messages. Here it is our example
avro schema:

```json
{{#include ../kafka-avro/src/main/avro/suppliers-v1.avsc}}
```

For compiling the AVRO schema into java classes you should use the following command:

```bash
avro-tools compile schema kafka-avro/src/main/avro/suppliers-v1.avsc kafka-avro/src/main/java/
```

### Setup

Create a topic:

```bash
kafka-topics --create --bootstrap-server localhost:19092 \
             --replication-factor 3 \
             --partitions 3 \
             --topic client.suppliers
```

### Produce

As you can see now we are using the autogenerated class `Supplier`.

```java
KafkaProducer<String, Supplier> producer = new KafkaProducer<>(props);

for (int i = 0; i < messages; i++) {
    Supplier supplier = createNewCustomer();
    ProducerRecord<String, Supplier> record = new ProducerRecord<>(
        topic,
        supplier.getId().toString(),
        supplier
    );
    producer.send(
        record,
        (metadata, exception) -> log.info("Producing message: {}", supplier)
    );
}
```

```bash
./gradlew kafka-clients:run --args="produce client.suppliers 100"
```

### Consume

It is the same for the consumer, we are using the avro class `Supplier`.

```java
ConsumerRecords<String, Supplier> records = consumer.poll(Duration.ofMillis(500));

for (ConsumerRecord<String, Supplier> record : records) {
    log.info("Supplier ID: {}", record.key());
}
```

```bash
./gradlew kafka-clients:run --args="consume client.suppliers"
```
